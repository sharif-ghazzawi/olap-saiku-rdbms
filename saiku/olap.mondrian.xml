<?xml version="1.0"?>
<Schema name="olap">

    <Dimension name="Classification">
        <Hierarchy hasAll="true" primaryKey="id">
            <Table name="classification"/>
            <Level name="Classification" column="name"/>
        </Hierarchy>
    </Dimension>

    <Dimension name="Collection Date" type="TimeDimension">
        <Hierarchy hasAll="true" allMemberName="All Periods" primaryKey="id">
            <Table name="collectionDate"/>
            <Level name="Year" uniqueMembers="true" levelType="TimeYears">
                <KeyExpression>
                    <SQL dialect="mysql">
                        CAST(YEAR(date) AS CHAR(4))
                    </SQL>
                </KeyExpression>
                <OrdinalExpression>
                    <SQL dialect="mysql">
                        YEAR(date)
                    </SQL>
                </OrdinalExpression>
            </Level>
            <Level name="Month" uniqueMembers="false" levelType="TimeMonths">
                <KeyExpression>
                    <SQL dialect="mysql">
                        MONTHNAME(date)
                    </SQL>
                </KeyExpression>
                <OrdinalExpression>
                    <SQL dialect="mysql">
                        MONTH(date)
                    </SQL>
                </OrdinalExpression>
            </Level>
            <Level name="Date" uniqueMembers="false" levelType="TimeDays">
                <KeyExpression>
                    <SQL dialect="mysql">
                        CAST(DAYOFMONTH(date) AS CHAR(2))
                    </SQL>
                </KeyExpression>
                <OrdinalExpression>
                    <SQL dialect="mysql">
                        DAYOFMONTH(date)
                    </SQL>
                </OrdinalExpression>
            </Level>
        </Hierarchy>
    </Dimension>

    <Dimension name="Document">
        <Hierarchy hasAll="true" primaryKey="id">
            <Table name="document"/>
            <Level name="DRSI ID" column="drsiDocId"/>
            <Level name="Title" column="title"/>
            <Level name="Full Text" column="body"/>
        </Hierarchy>
    </Dimension>

    <Dimension name="Document Length Group">
        <Hierarchy hasAll="true" primaryKey="id">
            <Table name="documentLengthGroup"/>
            <Level name="Coarse" column="coarseName" ordinalColumn="coarseLower"/>
            <Level name="Fine" column="fineName" ordinalColumn="fineLower"/>
        </Hierarchy>
    </Dimension>

    <Dimension name="Document Length Percentile">
        <Hierarchy hasAll="true" primaryKey="id">
            <Table name="documentLengthPercentile"/>
            <Level name="Coarse" column="coarseName" ordinalColumn="coarseLower"/>
            <Level name="Percentile" column="percentile"/>
        </Hierarchy>
    </Dimension>

    <Dimension name="Extracted Location">
        <Hierarchy hasAll="true" primaryKey="id" primaryKeyTable="extractedLocation">
            <Join leftKey="commandId" rightKey="id">
                <Table name="extractedLocation"/>
                <Table name="command"/>
            </Join>
            <Level name="Command" table="command" column="name" ordinalColumn="id"/>
            <Level name="Country" table="extractedLocation" column="countryName">
                <Property name="Country Clavin ID" table="extractedLocation" column="countryClavinId"/>
                <Property name="Country Code (ISO)" table="extractedLocation" column="countryIso"/>
            </Level>
            <Level name="State/Province" table="extractedLocation" column="subnationalName">
                <Property name="State/Province Clavin ID" table="extractedLocation" column="subnationalClavinId"/>
            </Level>
            <Level name="Location" table="extractedLocation" column="name">
                <Property name="Clavin ID" table="extractedLocation" column="clavinId"/>
                <Property name="Latitude" table="extractedLocation" column="latitude"/>
                <Property name="Longitude" table="extractedLocation" column="longitude"/>
            </Level>
        </Hierarchy>
    </Dimension>

    <Dimension name="Extracted Date" type="TimeDimension">
        <Hierarchy hasAll="true" allMemberName="All Periods" primaryKey="id">
            <Table name="extractedDate"/>
            <Level name="Year" uniqueMembers="true" levelType="TimeYears">
                <KeyExpression>
                    <SQL dialect="mysql">
                        CAST(YEAR(date) AS CHAR(4))
                    </SQL>
                </KeyExpression>
                <OrdinalExpression>
                    <SQL dialect="mysql">
                        YEAR(date)
                    </SQL>
                </OrdinalExpression>
            </Level>
            <Level name="Month" uniqueMembers="false" levelType="TimeMonths">
                <KeyExpression>
                    <SQL dialect="mysql">
                        MONTHNAME(date)
                    </SQL>
                </KeyExpression>
                <OrdinalExpression>
                    <SQL dialect="mysql">
                        MONTH(date)
                    </SQL>
                </OrdinalExpression>
            </Level>
            <Level name="Date" uniqueMembers="false" levelType="TimeDays">
                <KeyExpression>
                    <SQL dialect="mysql">
                        CAST(DAYOFMONTH(date) AS CHAR(2))
                    </SQL>
                </KeyExpression>
                <OrdinalExpression>
                    <SQL dialect="mysql">
                        DAYOFMONTH(date)
                    </SQL>
                </OrdinalExpression>
            </Level>
        </Hierarchy>
    </Dimension>

    <Dimension name="Ingest Date" type="TimeDimension">
        <Hierarchy hasAll="true" allMemberName="All Periods" primaryKey="id">
            <Table name="ingestDate"/>
            <Level name="Year" uniqueMembers="true" levelType="TimeYears">
                <KeyExpression>
                    <SQL dialect="mysql">
                        CAST(YEAR(date) AS CHAR(4))
                    </SQL>
                </KeyExpression>
                <OrdinalExpression>
                    <SQL dialect="mysql">
                        YEAR(date)
                    </SQL>
                </OrdinalExpression>
            </Level>
            <Level name="Month" uniqueMembers="false" levelType="TimeMonths">
                <KeyExpression>
                    <SQL dialect="mysql">
                        MONTHNAME(date)
                    </SQL>
                </KeyExpression>
                <OrdinalExpression>
                    <SQL dialect="mysql">
                        MONTH(date)
                    </SQL>
                </OrdinalExpression>
            </Level>
            <Level name="Date" uniqueMembers="false" levelType="TimeDays">
                <KeyExpression>
                    <SQL dialect="mysql">
                        CAST(DAYOFMONTH(date) AS CHAR(2))
                    </SQL>
                </KeyExpression>
                <OrdinalExpression>
                    <SQL dialect="mysql">
                        DAYOFMONTH(date)
                    </SQL>
                </OrdinalExpression>
            </Level>
        </Hierarchy>
    </Dimension>

    <Dimension name="Organization Percentile">
        <Hierarchy hasAll="true" primaryKey="id">
            <Table name="organizationPercentile"/>
            <Level name="Coarse" column="coarseName" ordinalColumn="coarseLower"/>
            <Level name="Percentile" column="percentile"/>
        </Hierarchy>
    </Dimension>

    <Dimension name="Person Percentile">
        <Hierarchy hasAll="true" primaryKey="id">
            <Table name="personPercentile"/>
            <Level name="Coarse" column="coarseName" ordinalColumn="coarseLower"/>
            <Level name="Percentile" column="percentile"/>
        </Hierarchy>
    </Dimension>

    <Dimension name="Publication Date" type="TimeDimension">
        <Hierarchy hasAll="true" allMemberName="All Periods" primaryKey="id">
            <Table name="publicationDate"/>
            <Level name="Year" uniqueMembers="true" levelType="TimeYears">
                <KeyExpression>
                    <SQL dialect="mysql">
                        CAST(YEAR(date) AS CHAR(4))
                    </SQL>
                </KeyExpression>
                <OrdinalExpression>
                    <SQL dialect="mysql">
                        YEAR(date)
                    </SQL>
                </OrdinalExpression>
            </Level>
            <Level name="Month" uniqueMembers="false" levelType="TimeMonths">
                <KeyExpression>
                    <SQL dialect="mysql">
                        MONTHNAME(date)
                    </SQL>
                </KeyExpression>
                <OrdinalExpression>
                    <SQL dialect="mysql">
                        MONTH(date)
                    </SQL>
                </OrdinalExpression>
            </Level>
            <Level name="Date" uniqueMembers="false" levelType="TimeDays">
                <KeyExpression>
                    <SQL dialect="mysql">
                        CAST(DAYOFMONTH(date) AS CHAR(2))
                    </SQL>
                </KeyExpression>
                <OrdinalExpression>
                    <SQL dialect="mysql">
                        DAYOFMONTH(date)
                    </SQL>
                </OrdinalExpression>
            </Level>
        </Hierarchy>
    </Dimension>

    <Dimension name="Source">
        <Hierarchy hasAll="true" primaryKey="id">
            <Table name="source"/>
            <Level name="Type" column="type"/>
            <Level name="Name" column="name"/>
        </Hierarchy>
    </Dimension>

    <Dimension name="Word Stem Percentile">
        <Hierarchy hasAll="true" primaryKey="id">
            <Table name="wordStemPercentile"/>
            <Level name="Coarse" column="coarseName" ordinalColumn="coarseLower"/>
            <Level name="Percentile" column="percentile"/>
        </Hierarchy>
    </Dimension>

    <Cube name="Words" defaultMeasure="Document Count">
        <Table name="wordFact"/>
        <Dimension name="Word" foreignKey="wordId">
            <Hierarchy hasAll="true" primaryKey="id">
                <Table name="word"/>
                <Level name="Coarse" column="coarseName" ordinalColumn="coarseId" uniqueMembers="false"/>
                <Level name="Medium" column="mediumName" ordinalColumn="mediumId" uniqueMembers="false"/>
                <Level name="Fine" column="fineName" ordinalColumn="fineId" uniqueMembers="false"/>
                <Level name="Word Stem" column="stem" uniqueMembers="false"/>
                <Level name="Word" column="word" uniqueMembers="false"/>
            </Hierarchy>
        </Dimension>
        <DimensionUsage name="Document" source="Document" foreignKey="documentId"/>
        <DimensionUsage name="Location" source="Extracted Location" foreignKey="extractedLocationId"/>
        <DimensionUsage name="Extracted Date" source="Extracted Date" foreignKey="extractedDateId"/>
        <DimensionUsage name="Publication date" source="Publication Date" foreignKey="publicationDateId"/>
        <DimensionUsage name="Ingestion date" source="Ingest Date" foreignKey="ingestDateId"/>
        <DimensionUsage name="Collection date" source="Collection Date" foreignKey="collectionDateId"/>
        <DimensionUsage name="Classification" source="Classification" foreignKey="classificationId"/>
        <DimensionUsage name="Source" source="Source" foreignKey="sourceId"/>
        <DimensionUsage name="Document Length Group" source="Document Length Group" foreignKey="documentLengthGroupId"/>
        <DimensionUsage name="Document Length Percentile" source="Document Length Percentile"
                        foreignKey="documentLengthPercentileId"/>
        <DimensionUsage name="Word Stem Percentile" source="Word Stem Percentile" foreignKey="wordStemPercentileId"/>

        <Measure name="Entry Count" column="id" aggregator="count" formatString="Standard"/>
        <Measure name="Document Count" column="documentId" aggregator="distinct-count" formatString="Standard"/>
        <Measure name="Document Length" column="documentLengthWords" aggregator="avg" formatString="Standard"/>
        <Measure name="Frequency of Appearance" column="wordFrequency" aggregator="avg" formatString="Standard"/>
        <Measure name="Frequency Share" column="wordFrequencyShare" aggregator="avg" formatString="Standard"/>
        <Measure name="Position in Document" column="position" aggregator="avg" formatString="Standard"/>
        <Measure name="Position Percentile" column="positionPercentile" aggregator="count" formatString="Standard"/>
    </Cube>

    <Cube name="People" defaultMeasure="Document Count">
        <Table name="personFact"/>
        <Dimension name="Person" foreignKey="personId">
            <Hierarchy hasAll="true" primaryKey="id">
                <Table name="word"/>
                <Level name="Coarse" column="coarseName" ordinalColumn="coarseId" uniqueMembers="false"/>
                <Level name="Medium" column="mediumName" ordinalColumn="mediumId" uniqueMembers="false"/>
                <Level name="Fine" column="fineName" ordinalColumn="fineId" uniqueMembers="false"/>
                <Level name="Concept" column="concept" uniqueMembers="false"/>
                <Level name="Name" column="name" uniqueMembers="false"/>
            </Hierarchy>
        </Dimension>
        <DimensionUsage name="Document" source="Document" foreignKey="documentId"/>
        <DimensionUsage name="Location" source="Extracted Location" foreignKey="extractedLocationId"/>
        <DimensionUsage name="Extracted Date" source="Extracted Date" foreignKey="extractedDateId"/>
        <DimensionUsage name="Publication date" source="Publication Date" foreignKey="publicationDateId"/>
        <DimensionUsage name="Ingestion date" source="Ingest Date" foreignKey="ingestDateId"/>
        <DimensionUsage name="Collection date" source="Collection Date" foreignKey="collectionDateId"/>
        <DimensionUsage name="Classification" source="Classification" foreignKey="classificationId"/>
        <DimensionUsage name="Source" source="Source" foreignKey="sourceId"/>
        <DimensionUsage name="Document Length Group" source="Document Length Group" foreignKey="documentLengthGroupId"/>
        <DimensionUsage name="Document Length Percentile" source="Document Length Percentile"
                        foreignKey="documentLengthPercentileId"/>
        <DimensionUsage name="Person Percentile" source="Person Percentile" foreignKey="personPercentileId"/>

        <Measure name="Entry Count" column="id" aggregator="count" formatString="Standard"/>
        <Measure name="Document Count" column="documentId" aggregator="distinct-count" formatString="Standard"/>
        <Measure name="Document Length" column="documentLengthWords" aggregator="avg" formatString="Standard"/>
        <Measure name="Frequency of Appearance" column="personFrequency" aggregator="avg" formatString="Standard"/>
        <Measure name="Frequency Share" column="personFrequencyShare" aggregator="avg" formatString="Standard"/>
        <Measure name="Position in Document" column="position" aggregator="avg" formatString="Standard"/>
        <Measure name="Position Percentile" column="positionPercentile" aggregator="count" formatString="Standard"/>
    </Cube>

    <Cube name="Organizations" defaultMeasure="Document Count">
        <Table name="organizationFact"/>
        <Dimension name="Organization" foreignKey="organizationId">
            <Hierarchy hasAll="true" primaryKey="id">
                <Table name="word"/>
                <Level name="Coarse" column="coarseName" ordinalColumn="coarseId" uniqueMembers="false"/>
                <Level name="Medium" column="mediumName" ordinalColumn="mediumId" uniqueMembers="false"/>
                <Level name="Fine" column="fineName" ordinalColumn="fineId" uniqueMembers="false"/>
                <Level name="Concept" column="concept" uniqueMembers="false"/>
                <Level name="Name" column="name" uniqueMembers="false"/>
            </Hierarchy>
        </Dimension>
        <DimensionUsage name="Document" source="Document" foreignKey="documentId"/>
        <DimensionUsage name="Location" source="Extracted Location" foreignKey="extractedLocationId"/>
        <DimensionUsage name="Extracted Date" source="Extracted Date" foreignKey="extractedDateId"/>
        <DimensionUsage name="Publication date" source="Publication Date" foreignKey="publicationDateId"/>
        <DimensionUsage name="Ingestion date" source="Ingest Date" foreignKey="ingestDateId"/>
        <DimensionUsage name="Collection date" source="Collection Date" foreignKey="collectionDateId"/>
        <DimensionUsage name="Classification" source="Classification" foreignKey="classificationId"/>
        <DimensionUsage name="Source" source="Source" foreignKey="sourceId"/>
        <DimensionUsage name="Document Length Group" source="Document Length Group" foreignKey="documentLengthGroupId"/>
        <DimensionUsage name="Document Length Percentile" source="Document Length Percentile"
                        foreignKey="documentLengthPercentileId"/>
        <DimensionUsage name="Organization Percentile" source="Organization Percentile" foreignKey="organizationPercentileId"/>

        <Measure name="Entry Count" column="id" aggregator="count" formatString="Standard"/>
        <Measure name="Document Count" column="documentId" aggregator="distinct-count" formatString="Standard"/>
        <Measure name="Document Length" column="documentLengthWords" aggregator="avg" formatString="Standard"/>
        <Measure name="Frequency of Appearance" column="orgFrequency" aggregator="avg" formatString="Standard"/>
        <Measure name="Frequency Share" column="orgFrequencyShare" aggregator="avg" formatString="Standard"/>
        <Measure name="Position in Document" column="position" aggregator="avg" formatString="Standard"/>
        <Measure name="Position Percentile" column="positionPercentile" aggregator="count" formatString="Standard"/>
    </Cube>
</Schema>
