<?xml version="1.0"?>
<Schema name="olap">

    <Dimension name="Classification">
        <Hierarchy hasAll="true" primaryKey="id">
            <Table name="classification"/>
            <Level name="Classification" column="name"/>
        </Hierarchy>
    </Dimension>

    <Dimension name="Collection Date" type="TimeDimension">
        <Hierarchy hasAll="true" allMemberName="All Periods" primaryKey="id">
            <View alias="CollectionDateView">
                <SQL dialect="mysql">
                    SELECT
                        cd.id AS id,
                        cd.date AS collectionDate
                    FROM
                        collectionDate AS cd
                </SQL>
            </View>
            <Level name="Year" uniqueMembers="true" levelType="TimeYears">
                <KeyExpression>
                    <SQL dialect="mysql">
                        CAST(YEAR(collectionDate) AS CHAR(4))
                    </SQL>
                </KeyExpression>
                <OrdinalExpression>
                    <SQL dialect="mysql">
                        YEAR(collectionDate)
                    </SQL>
                </OrdinalExpression>
            </Level>
            <Level name="Month" uniqueMembers="false" levelType="TimeMonths">
                <KeyExpression>
                    <SQL dialect="mysql">
                        MONTHNAME(collectionDate)
                    </SQL>
                </KeyExpression>
                <OrdinalExpression>
                    <SQL dialect="mysql">
                        MONTH(collectionDate)
                    </SQL>
                </OrdinalExpression>
            </Level>
            <Level name="Date" uniqueMembers="false" levelType="TimeDays">
                <KeyExpression>
                    <SQL dialect="mysql">
                        CAST(DAYOFMONTH(collectionDate) AS CHAR(2))
                    </SQL>
                </KeyExpression>
                <OrdinalExpression>
                    <SQL dialect="mysql">
                        DAYOFMONTH(collectionDate)
                    </SQL>
                </OrdinalExpression>
            </Level>
        </Hierarchy>
    </Dimension>

    <Dimension name="Document">
        <Hierarchy hasAll="true" primaryKey="id">
            <Table name="document"/>
            <Level name="DRSI ID" column="drsiDocId"/>
            <Level name="Title" column="title"/>
            <Level name="Full Text" column="body"/>
        </Hierarchy>
    </Dimension>

    <Dimension name="Document Length Group">
        <Hierarchy hasAll="true" primaryKey="id">
            <Table name="documentLengthGroup"/>
            <Level name="Coarse" column="coarseName" ordinalColumn="coarseLower"/>
            <Level name="Fine" column="fineName" ordinalColumn="fineLower"/>
        </Hierarchy>
    </Dimension>

    <Dimension name="Document Length Percentile">
        <Hierarchy hasAll="true" primaryKey="id">
            <Table name="documentLengthPercentile"/>
            <Level name="Coarse" column="coarseName" ordinalColumn="coarseLower"/>
            <Level name="Percentile" column="percentile"/>
        </Hierarchy>
    </Dimension>

    <Dimension name="Extracted Date" type="TimeDimension">
        <Hierarchy hasAll="true" allMemberName="All Periods" primaryKey="id">
            <View alias="ExtractedDateView">
                <SQL dialect="mysql">
                    SELECT
                        ed.id AS id,
                        ed.date AS extractedDate
                    FROM
                        extractedDate AS ed
                </SQL>
            </View>
            <Level name="Year" uniqueMembers="true" levelType="TimeYears">
                <KeyExpression>
                    <SQL dialect="mysql">
                        CAST(YEAR(extractedDate) AS CHAR(4))
                    </SQL>
                </KeyExpression>
                <OrdinalExpression>
                    <SQL dialect="mysql">
                        YEAR(extractedDate)
                    </SQL>
                </OrdinalExpression>
            </Level>
            <Level name="Month" uniqueMembers="false" levelType="TimeMonths">
                <KeyExpression>
                    <SQL dialect="mysql">
                        MONTHNAME(extractedDate)
                    </SQL>
                </KeyExpression>
                <OrdinalExpression>
                    <SQL dialect="mysql">
                        MONTH(extractedDate)
                    </SQL>
                </OrdinalExpression>
            </Level>
            <Level name="Date" uniqueMembers="false" levelType="TimeDays">
                <KeyExpression>
                    <SQL dialect="mysql">
                        CAST(DAYOFMONTH(extractedDate) AS CHAR(2))
                    </SQL>
                </KeyExpression>
                <OrdinalExpression>
                    <SQL dialect="mysql">
                        DAYOFMONTH(extractedDate)
                    </SQL>
                </OrdinalExpression>
            </Level>
        </Hierarchy>
    </Dimension>

    <Dimension name="Extracted Location">
        <Hierarchy hasAll="true" primaryKey="id">
            <View alias="Ex-location">
                <SQL dialect="mysql">
                    SELECT
                        loc.id AS id,
                        loc.clavinId AS clavinId,
                        loc.name AS locationName,
                        loc.countryClavinId AS countryClavinId,
                        loc.countryIso AS countryIso,
                        loc.countryName AS countryName,
                        com.id AS commandId,
                        com.name AS commandName,
                        loc.subnationalClavinId AS subnationalClavinId,
                        loc.subnationalName AS subnationalName,
                        loc.latitude AS latitude,
                        loc.longitude AS longitude
                    FROM
                        extractedLocation AS loc, command AS com
                    WHERE
                        loc.commandId = com.id
                </SQL>
            </View>
            <Level name="Command" column="commandName" ordinalColumn="commandId"/>
            <Level name="Country" column="countryName">
                <Property name="Country Clavin ID" column="countryClavinId"/>
                <Property name="Country Code (ISO)" column="countryIso"/>
            </Level>
            <Level name="State/Province">
                <KeyExpression>
                    <SQL dialect="mysql">
                        IF(subnationalClavinId=clavinId and countryClavinId=subnationalClavinId,
                            concat(countryName, " (Other)"), subnationalName)
                    </SQL>
                </KeyExpression>
                <Property name="State/Province Clavin ID" column="subnationalClavinId"/>
            </Level>
            <Level name="Location">
                <KeyExpression>
                    <SQL dialect="mysql">
                        IF(clavinId=countryClavinId, countryName, locationName)
                    </SQL>
                </KeyExpression>
                <Property name="Clavin ID" column="clavinId"/>
                <Property name="Latitude" column="latitude"/>
                <Property name="Longitude" column="longitude"/>
            </Level>
        </Hierarchy>
    </Dimension>

    <Dimension name="Ingest Date" type="TimeDimension">
        <Hierarchy hasAll="true" allMemberName="All Periods" primaryKey="id">
            <View alias="IngestionDateView">
                <SQL dialect="mysql">
                    SELECT
                        ing.id AS id,
                        ing.date AS ingestDate
                    FROM
                        ingestDate AS ing
                </SQL>
            </View>
            <Level name="Year" uniqueMembers="true" levelType="TimeYears">
                <KeyExpression>
                    <SQL dialect="mysql">
                        CAST(YEAR(ingestDate) AS CHAR(4))
                    </SQL>
                </KeyExpression>
                <OrdinalExpression>
                    <SQL dialect="mysql">
                        YEAR(ingestDate)
                    </SQL>
                </OrdinalExpression>
            </Level>
            <Level name="Month" uniqueMembers="false" levelType="TimeMonths">
                <KeyExpression>
                    <SQL dialect="mysql">
                        MONTHNAME(ingestDate)
                    </SQL>
                </KeyExpression>
                <OrdinalExpression>
                    <SQL dialect="mysql">
                        MONTH(ingestDate)
                    </SQL>
                </OrdinalExpression>
            </Level>
            <Level name="Date" uniqueMembers="false" levelType="TimeDays">
                <KeyExpression>
                    <SQL dialect="mysql">
                        CAST(DAYOFMONTH(ingestDate) AS CHAR(2))
                    </SQL>
                </KeyExpression>
                <OrdinalExpression>
                    <SQL dialect="mysql">
                        DAYOFMONTH(ingestDate)
                    </SQL>
                </OrdinalExpression>
            </Level>
        </Hierarchy>
    </Dimension>

    <Dimension name="Organization Percentile">
        <Hierarchy hasAll="true" primaryKey="id">
            <Table name="organizationPercentile"/>
            <Level name="Coarse" column="coarseName" ordinalColumn="coarseLower"/>
            <Level name="Percentile" column="percentile"/>
        </Hierarchy>
    </Dimension>

    <Dimension name="Person Percentile">
        <Hierarchy hasAll="true" primaryKey="id">
            <Table name="personPercentile"/>
            <Level name="Coarse" column="coarseName" ordinalColumn="coarseLower"/>
            <Level name="Percentile" column="percentile"/>
        </Hierarchy>
    </Dimension>

    <Dimension name="Publication Date" type="TimeDimension">
        <Hierarchy hasAll="true" allMemberName="All Periods" primaryKey="id">
            <View alias="PublicationDateView">
                <SQL dialect="mysql">
                    SELECT
                        pd.id AS id,
                        pd.date AS pubDate
                    FROM
                        publicationDate AS pd
                </SQL>
            </View>
            <Level name="Year" uniqueMembers="true" levelType="TimeYears">
                <KeyExpression>
                    <SQL dialect="mysql">
                        CAST(YEAR(pubDate) AS CHAR(4))
                    </SQL>
                </KeyExpression>
                <OrdinalExpression>
                    <SQL dialect="mysql">
                        YEAR(pubDate)
                    </SQL>
                </OrdinalExpression>
            </Level>
            <Level name="Month" uniqueMembers="false" levelType="TimeMonths">
                <KeyExpression>
                    <SQL dialect="mysql">
                        MONTHNAME(pubDate)
                    </SQL>
                </KeyExpression>
                <OrdinalExpression>
                    <SQL dialect="mysql">
                        MONTH(pubDate)
                    </SQL>
                </OrdinalExpression>
            </Level>
            <Level name="Date" uniqueMembers="false" levelType="TimeDays">
                <KeyExpression>
                    <SQL dialect="mysql">
                        CAST(DAYOFMONTH(pubDate) AS CHAR(2))
                    </SQL>
                </KeyExpression>
                <OrdinalExpression>
                    <SQL dialect="mysql">
                        DAYOFMONTH(pubDate)
                    </SQL>
                </OrdinalExpression>
            </Level>
        </Hierarchy>
    </Dimension>

    <Dimension name="Source">
        <Hierarchy hasAll="true" primaryKey="id">
            <Table name="source"/>
            <Level name="Type" column="type"/>
            <Level name="Name" column="name"/>
        </Hierarchy>
    </Dimension>

    <Dimension name="Word Stem Percentile">
        <Hierarchy hasAll="true" primaryKey="id">
            <Table name="wordStemPercentile"/>
            <Level name="Coarse" column="coarseName" ordinalColumn="coarseLower"/>
            <Level name="Percentile" column="percentile"/>
        </Hierarchy>
    </Dimension>

    <Cube name="Words" defaultMeasure="Document Count">
        <Table name="wordFact"/>
        <Dimension name="Word" foreignKey="wordId">
            <Hierarchy hasAll="true" primaryKey="id">
                <Table name="word"/>
                <Level name="Coarse" column="coarseName" ordinalColumn="coarseId" uniqueMembers="false"/>
                <Level name="Medium" column="mediumName" ordinalColumn="mediumId" uniqueMembers="false"/>
                <Level name="Fine" column="fineName" ordinalColumn="fineId" uniqueMembers="false"/>
                <Level name="Word Stem" column="stem" uniqueMembers="false"/>
                <Level name="Word" column="word" uniqueMembers="false"/>
            </Hierarchy>
        </Dimension>
        <DimensionUsage name="Document" source="Document" foreignKey="documentId"/>
        <DimensionUsage name="Location" source="Extracted Location" foreignKey="extractedLocationId"/>
        <DimensionUsage name="Extracted Date" source="Extracted Date" foreignKey="extractedDateId"/>
        <DimensionUsage name="Publication date" source="Publication Date" foreignKey="publicationDateId"/>
        <DimensionUsage name="Ingestion date" source="Ingest Date" foreignKey="ingestDateId"/>
        <DimensionUsage name="Collection date" source="Collection Date" foreignKey="collectionDateId"/>
        <DimensionUsage name="Classification" source="Classification" foreignKey="classificationId"/>
        <DimensionUsage name="Source" source="Source" foreignKey="sourceId"/>
        <DimensionUsage name="Document Length Group" source="Document Length Group" foreignKey="documentLengthGroupId"/>
        <DimensionUsage name="Document Length Percentile" source="Document Length Percentile"
                        foreignKey="documentLengthPercentileId"/>
        <DimensionUsage name="Word Stem Percentile" source="Word Stem Percentile" foreignKey="wordStemPercentileId"/>

        <Measure name="Entry Count" column="id" aggregator="count" formatString="Standard"/>
        <Measure name="Document Count" column="documentId" aggregator="distinct-count" formatString="Standard"/>
        <Measure name="Document Length" column="documentLengthWords" aggregator="avg" formatString="Standard"/>
        <Measure name="Frequency of Appearance" column="wordFrequency" aggregator="avg" formatString="Standard"/>
        <Measure name="Frequency Share" column="wordFrequencyShare" aggregator="avg" formatString="Standard"/>
        <Measure name="Position in Document" column="position" aggregator="avg" formatString="Standard"/>
        <Measure name="Position Percentile" column="positionPercentile" aggregator="count" formatString="Standard"/>
    </Cube>

    <Cube name="People" defaultMeasure="Document Count">
        <Table name="personFact"/>
        <Dimension name="Person" foreignKey="personId">
            <Hierarchy hasAll="true" primaryKey="id">
                <Table name="word"/>
                <Level name="Coarse" column="coarseName" ordinalColumn="coarseId" uniqueMembers="false"/>
                <Level name="Medium" column="mediumName" ordinalColumn="mediumId" uniqueMembers="false"/>
                <Level name="Fine" column="fineName" ordinalColumn="fineId" uniqueMembers="false"/>
                <Level name="Concept" column="concept" uniqueMembers="false"/>
                <Level name="Name" column="name" uniqueMembers="false"/>
            </Hierarchy>
        </Dimension>
        <DimensionUsage name="Document" source="Document" foreignKey="documentId"/>
        <DimensionUsage name="Location" source="Extracted Location" foreignKey="extractedLocationId"/>
        <DimensionUsage name="Extracted Date" source="Extracted Date" foreignKey="extractedDateId"/>
        <DimensionUsage name="Publication date" source="Publication Date" foreignKey="publicationDateId"/>
        <DimensionUsage name="Ingestion date" source="Ingest Date" foreignKey="ingestDateId"/>
        <DimensionUsage name="Collection date" source="Collection Date" foreignKey="collectionDateId"/>
        <DimensionUsage name="Classification" source="Classification" foreignKey="classificationId"/>
        <DimensionUsage name="Source" source="Source" foreignKey="sourceId"/>
        <DimensionUsage name="Document Length Group" source="Document Length Group" foreignKey="documentLengthGroupId"/>
        <DimensionUsage name="Document Length Percentile" source="Document Length Percentile"
                        foreignKey="documentLengthPercentileId"/>
        <DimensionUsage name="Person Percentile" source="Person Percentile" foreignKey="personPercentileId"/>

        <Measure name="Entry Count" column="id" aggregator="count" formatString="Standard"/>
        <Measure name="Document Count" column="documentId" aggregator="distinct-count" formatString="Standard"/>
        <Measure name="Document Length" column="documentLengthWords" aggregator="avg" formatString="Standard"/>
        <Measure name="Frequency of Appearance" column="personFrequency" aggregator="avg" formatString="Standard"/>
        <Measure name="Frequency Share" column="personFrequencyShare" aggregator="avg" formatString="Standard"/>
        <Measure name="Position in Document" column="position" aggregator="avg" formatString="Standard"/>
        <Measure name="Position Percentile" column="positionPercentile" aggregator="count" formatString="Standard"/>
    </Cube>

    <Cube name="Organizations" defaultMeasure="Document Count">
        <Table name="organizationFact"/>
        <Dimension name="Organization" foreignKey="organizationId">
            <Hierarchy hasAll="true" primaryKey="id">
                <Table name="word"/>
                <Level name="Coarse" column="coarseName" ordinalColumn="coarseId" uniqueMembers="false"/>
                <Level name="Medium" column="mediumName" ordinalColumn="mediumId" uniqueMembers="false"/>
                <Level name="Fine" column="fineName" ordinalColumn="fineId" uniqueMembers="false"/>
                <Level name="Concept" column="concept" uniqueMembers="false"/>
                <Level name="Name" column="name" uniqueMembers="false"/>
            </Hierarchy>
        </Dimension>
        <DimensionUsage name="Document" source="Document" foreignKey="documentId"/>
        <DimensionUsage name="Location" source="Extracted Location" foreignKey="extractedLocationId"/>
        <DimensionUsage name="Extracted Date" source="Extracted Date" foreignKey="extractedDateId"/>
        <DimensionUsage name="Publication date" source="Publication Date" foreignKey="publicationDateId"/>
        <DimensionUsage name="Ingestion date" source="Ingest Date" foreignKey="ingestDateId"/>
        <DimensionUsage name="Collection date" source="Collection Date" foreignKey="collectionDateId"/>
        <DimensionUsage name="Classification" source="Classification" foreignKey="classificationId"/>
        <DimensionUsage name="Source" source="Source" foreignKey="sourceId"/>
        <DimensionUsage name="Document Length Group" source="Document Length Group" foreignKey="documentLengthGroupId"/>
        <DimensionUsage name="Document Length Percentile" source="Document Length Percentile"
                        foreignKey="documentLengthPercentileId"/>
        <DimensionUsage name="Organization Percentile" source="Organization Percentile" foreignKey="organizationPercentileId"/>

        <Measure name="Entry Count" column="id" aggregator="count" formatString="Standard"/>
        <Measure name="Document Count" column="documentId" aggregator="distinct-count" formatString="Standard"/>
        <Measure name="Document Length" column="documentLengthWords" aggregator="avg" formatString="Standard"/>
        <Measure name="Frequency of Appearance" column="orgFrequency" aggregator="avg" formatString="Standard"/>
        <Measure name="Frequency Share" column="orgFrequencyShare" aggregator="avg" formatString="Standard"/>
        <Measure name="Position in Document" column="position" aggregator="avg" formatString="Standard"/>
        <Measure name="Position Percentile" column="positionPercentile" aggregator="count" formatString="Standard"/>
    </Cube>
</Schema>
