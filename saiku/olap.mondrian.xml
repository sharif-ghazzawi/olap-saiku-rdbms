<?xml version="1.0"?>
<Schema name="olap">

    <Dimension name="Classification">
        <Hierarchy hasAll="true" primaryKey="id">
            <Table name="classification"/>
            <Level name="Classification" column="name"/>
        </Hierarchy>
    </Dimension>

    <Dimension name="Collection Date" type="TimeDimension">
        <Hierarchy hasAll="true" allMemberName="All Periods" primaryKey="id">
            <Table name="collectionDate"/>
            <Level name="Year" column="year" uniqueMembers="true" levelType="TimeYears"/>
            <Level name="Month" column="monthName" ordinalColumn="month" uniqueMembers="false" levelType="TimeMonths"/>
            <Level name="Date" column="dayOfMonth" uniqueMembers="false" levelType="TimeDays"/>
        </Hierarchy>
    </Dimension>

    <Dimension name="Document">
        <Hierarchy hasAll="true" primaryKey="id">
            <Table name="document"/>
            <Level name="Title" column="title">
                <Property name="DRSI ID" column="drsiDocId"/>
            </Level>
            <Level name="Full Text" column="body" visible="false"/>
        </Hierarchy>
    </Dimension>

    <Dimension name="Document Length Group">
        <Hierarchy hasAll="true" primaryKey="id">
            <Table name="documentLengthGroup"/>
            <Level name="Coarse" column="coarseName" ordinalColumn="coarseLower"/>
            <Level name="Fine" column="fineName" ordinalColumn="fineLower"/>
        </Hierarchy>
    </Dimension>

    <Dimension name="Document Length Percentile">
        <Hierarchy hasAll="true" primaryKey="id">
            <Table name="documentLengthPercentile"/>
            <Level name="Coarse" column="coarseName" ordinalColumn="coarseLower"/>
            <Level name="Percentile" column="percentile"/>
        </Hierarchy>
    </Dimension>

    <Dimension name="Extracted Date" type="TimeDimension">
        <Hierarchy hasAll="true" allMemberName="All Periods" primaryKey="id">
            <Table name="extractedDate"/>
            <Level name="Year" column="year" uniqueMembers="true" levelType="TimeYears"/>
            <Level name="Month" column="monthName" ordinalColumn="month" uniqueMembers="false" levelType="TimeMonths"/>
            <Level name="Date" column="dayOfMonth" uniqueMembers="false" levelType="TimeDays"/>
        </Hierarchy>
    </Dimension>

    <Dimension name="Extracted Location">
        <Hierarchy hasAll="true" primaryKey="id">
            <Table name="extractedLocation"/>
            <Level name="Command" column="command">
                <OrdinalExpression>
                    <SQL dialect="mysql">
                        IF(command="N/A", "Z", command)
                    </SQL>
                </OrdinalExpression>
            </Level>
            <Level name="Country">
                <KeyExpression>
                    <SQL dialect="mysql">
                        IF(countryName="No Man's Land", "No Associated Country", countryName)
                    </SQL>
                </KeyExpression>
                <OrdinalExpression>
                    <SQL dialect="mysql">
                        IF(countryName="No Man's Land", "ZZZZZ", countryName)
                    </SQL>
                </OrdinalExpression>
                <Property name="Country Clavin ID" column="countryClavinId"/>
                <Property name="Country Code (ISO)" column="countryIso"/>
            </Level>
            <Level name="State/Province">
                <KeyExpression>
                    <SQL dialect="mysql">
                        IF(subnationalClavinId=clavinId and countryClavinId=subnationalClavinId,
                            concat(countryName, " (Other)"), subnationalName)
                    </SQL>
                </KeyExpression>
                <OrdinalExpression>
                    <SQL dialect="mysql">
                        IF(subnationalClavinId=clavinId and countryClavinId=subnationalClavinId,
                            "ZZZZZ", subnationalName)
                    </SQL>
                </OrdinalExpression>
                <Property name="State/Province Clavin ID" column="subnationalClavinId"/>
            </Level>
            <Level name="Location">
                <KeyExpression>
                    <SQL dialect="mysql">
                        IF(clavinId=countryClavinId, countryName, locationName)
                    </SQL>
                </KeyExpression>
                <Property name="Clavin ID" column="clavinId"/>
                <Property name="Latitude" column="latitude"/>
                <Property name="Longitude" column="longitude"/>
            </Level>
        </Hierarchy>
    </Dimension>

    <Dimension name="Ingest Date" type="TimeDimension">
        <Hierarchy hasAll="true" allMemberName="All Periods" primaryKey="id">
            <Table name="ingestDate"/>
            <Level name="Year" column="year" uniqueMembers="true" levelType="TimeYears"/>
            <Level name="Month" column="monthName" ordinalColumn="month" uniqueMembers="false" levelType="TimeMonths"/>
            <Level name="Date" column="dayOfMonth" uniqueMembers="false" levelType="TimeDays"/>
        </Hierarchy>
    </Dimension>

    <Dimension name="Organization Percentile">
        <Hierarchy hasAll="true" primaryKey="id">
            <Table name="organizationPercentile"/>
            <Level name="Coarse" column="coarseName" ordinalColumn="coarseLower"/>
            <Level name="Percentile" column="percentile"/>
        </Hierarchy>
    </Dimension>

    <Dimension name="Person Percentile">
        <Hierarchy hasAll="true" primaryKey="id">
            <Table name="personPercentile"/>
            <Level name="Coarse" column="coarseName" ordinalColumn="coarseLower"/>
            <Level name="Percentile" column="percentile"/>
        </Hierarchy>
    </Dimension>

    <Dimension name="Publication Date" type="TimeDimension">
        <Hierarchy hasAll="true" allMemberName="All Periods" primaryKey="id">
            <Table name="publicationDate"/>
            <Level name="Year" column="year" uniqueMembers="true" levelType="TimeYears"/>
            <Level name="Month" column="monthName" ordinalColumn="month" uniqueMembers="false" levelType="TimeMonths"/>
            <Level name="Date" column="dayOfMonth" uniqueMembers="false" levelType="TimeDays"/>
        </Hierarchy>
    </Dimension>

    <Dimension name="Source">
        <Hierarchy hasAll="true" primaryKey="id">
            <Table name="source"/>
            <Level name="Type" column="type"/>
            <Level name="Name" column="name"/>
        </Hierarchy>
    </Dimension>

    <Dimension name="Word Stem Percentile">
        <Hierarchy hasAll="true" primaryKey="id">
            <Table name="wordStemPercentile"/>
            <Level name="Coarse" column="coarseName" ordinalColumn="coarseLower"/>
            <Level name="Percentile" column="percentile"/>
        </Hierarchy>
    </Dimension>

    <Cube name="Words" defaultMeasure="Document Count">
        <Table name="wordFact"/>
        <Dimension name="Word" foreignKey="wordId">
            <Hierarchy hasAll="true" primaryKey="id">
                <Table name="word"/>
                <Level name="Coarse" column="coarseName" ordinalColumn="coarseId" uniqueMembers="false"/>
                <Level name="Medium" column="mediumName" ordinalColumn="mediumId" uniqueMembers="false"/>
                <Level name="Fine" column="fineName" ordinalColumn="fineId" uniqueMembers="false"/>
                <Level name="Word Stem" column="stem" uniqueMembers="false"/>
                <Level name="Word" column="word" uniqueMembers="false"/>
            </Hierarchy>
        </Dimension>
        <DimensionUsage name="Document" source="Document" foreignKey="documentId"/>
        <DimensionUsage name="Location" source="Extracted Location" foreignKey="extractedLocationId"/>
        <DimensionUsage name="Extracted Date" source="Extracted Date" foreignKey="extractedDateId"/>
        <DimensionUsage name="Publication date" source="Publication Date" foreignKey="publicationDateId"/>
        <DimensionUsage name="Ingestion date" source="Ingest Date" foreignKey="ingestDateId"/>
        <DimensionUsage name="Collection date" source="Collection Date" foreignKey="collectionDateId"/>
        <DimensionUsage name="Classification" source="Classification" foreignKey="classificationId"/>
        <DimensionUsage name="Source" source="Source" foreignKey="sourceId"/>
        <DimensionUsage name="Document Length Group" source="Document Length Group" foreignKey="documentLengthGroupId"/>
        <DimensionUsage name="Document Length Percentile" source="Document Length Percentile"
                        foreignKey="documentLengthPercentileId"/>
        <DimensionUsage name="Word Stem Percentile" source="Word Stem Percentile" foreignKey="wordStemPercentileId"/>

        <Measure name="Document Count" column="documentId" aggregator="distinct-count" formatString="Standard"/>
        <Measure name="Document Length" column="documentLengthWords" aggregator="avg" formatString="Standard"/>
        <Measure name="Frequency of Appearance" column="wordFrequency" aggregator="avg" formatString="Standard"/>
        <Measure name="Frequency Share" column="wordFrequencyShare" aggregator="avg" formatString="Standard"/>
        <Measure name="Position in Document" column="position" aggregator="avg" formatString="Standard"/>
        <Measure name="Position Percentile" column="positionPercentile" aggregator="count" formatString="Standard"/>
    </Cube>

    <Cube name="People" defaultMeasure="Document Count">
        <Table name="personFact"/>
        <Dimension name="Person" foreignKey="personId">
            <Hierarchy hasAll="true" primaryKey="id">
                <Table name="word"/>
                <Level name="Coarse" column="coarseName" ordinalColumn="coarseId" uniqueMembers="false"/>
                <Level name="Medium" column="mediumName" ordinalColumn="mediumId" uniqueMembers="false"/>
                <Level name="Fine" column="fineName" ordinalColumn="fineId" uniqueMembers="false"/>
                <Level name="Concept" column="concept" uniqueMembers="false"/>
                <Level name="Name" column="name" uniqueMembers="false"/>
            </Hierarchy>
        </Dimension>
        <DimensionUsage name="Document" source="Document" foreignKey="documentId"/>
        <DimensionUsage name="Location" source="Extracted Location" foreignKey="extractedLocationId"/>
        <DimensionUsage name="Extracted Date" source="Extracted Date" foreignKey="extractedDateId"/>
        <DimensionUsage name="Publication date" source="Publication Date" foreignKey="publicationDateId"/>
        <DimensionUsage name="Ingestion date" source="Ingest Date" foreignKey="ingestDateId"/>
        <DimensionUsage name="Collection date" source="Collection Date" foreignKey="collectionDateId"/>
        <DimensionUsage name="Classification" source="Classification" foreignKey="classificationId"/>
        <DimensionUsage name="Source" source="Source" foreignKey="sourceId"/>
        <DimensionUsage name="Document Length Group" source="Document Length Group" foreignKey="documentLengthGroupId"/>
        <DimensionUsage name="Document Length Percentile" source="Document Length Percentile"
                        foreignKey="documentLengthPercentileId"/>
        <DimensionUsage name="Person Percentile" source="Person Percentile" foreignKey="personPercentileId"/>

        <Measure name="Document Count" column="documentId" aggregator="distinct-count" formatString="Standard"/>
        <Measure name="Document Length" column="documentLengthWords" aggregator="avg" formatString="Standard"/>
        <Measure name="Frequency of Appearance" column="personFrequency" aggregator="avg" formatString="Standard"/>
        <Measure name="Frequency Share" column="personFrequencyShare" aggregator="avg" formatString="Standard"/>
        <Measure name="Position in Document" column="position" aggregator="avg" formatString="Standard"/>
        <Measure name="Position Percentile" column="positionPercentile" aggregator="count" formatString="Standard"/>
    </Cube>

    <Cube name="Organizations" defaultMeasure="Document Count">
        <Table name="organizationFact"/>
        <Dimension name="Organization" foreignKey="organizationId">
            <Hierarchy hasAll="true" primaryKey="id">
                <Table name="word"/>
                <Level name="Coarse" column="coarseName" ordinalColumn="coarseId" uniqueMembers="false"/>
                <Level name="Medium" column="mediumName" ordinalColumn="mediumId" uniqueMembers="false"/>
                <Level name="Fine" column="fineName" ordinalColumn="fineId" uniqueMembers="false"/>
                <Level name="Concept" column="concept" uniqueMembers="false"/>
                <Level name="Name" column="name" uniqueMembers="false"/>
            </Hierarchy>
        </Dimension>
        <DimensionUsage name="Document" source="Document" foreignKey="documentId"/>
        <DimensionUsage name="Location" source="Extracted Location" foreignKey="extractedLocationId"/>
        <DimensionUsage name="Extracted Date" source="Extracted Date" foreignKey="extractedDateId"/>
        <DimensionUsage name="Publication date" source="Publication Date" foreignKey="publicationDateId"/>
        <DimensionUsage name="Ingestion date" source="Ingest Date" foreignKey="ingestDateId"/>
        <DimensionUsage name="Collection date" source="Collection Date" foreignKey="collectionDateId"/>
        <DimensionUsage name="Classification" source="Classification" foreignKey="classificationId"/>
        <DimensionUsage name="Source" source="Source" foreignKey="sourceId"/>
        <DimensionUsage name="Document Length Group" source="Document Length Group" foreignKey="documentLengthGroupId"/>
        <DimensionUsage name="Document Length Percentile" source="Document Length Percentile"
                        foreignKey="documentLengthPercentileId"/>
        <DimensionUsage name="Organization Percentile" source="Organization Percentile" foreignKey="organizationPercentileId"/>

        <Measure name="Document Count" column="documentId" aggregator="distinct-count" formatString="Standard"/>
        <Measure name="Document Length" column="documentLengthWords" aggregator="avg" formatString="Standard"/>
        <Measure name="Frequency of Appearance" column="orgFrequency" aggregator="avg" formatString="Standard"/>
        <Measure name="Frequency Share" column="orgFrequencyShare" aggregator="avg" formatString="Standard"/>
        <Measure name="Position in Document" column="position" aggregator="avg" formatString="Standard"/>
        <Measure name="Position Percentile" column="positionPercentile" aggregator="count" formatString="Standard"/>
    </Cube>
</Schema>
